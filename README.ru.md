# FuryDumper üßô‚Äç

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≥–µ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏ –ª–µ–≥–∫–æ–≥–æ –¥–∞–ø–º–∞ –∏–∑ —É–¥–∞–ª–µ–Ω–æ–π –ë–î!

–î–∞–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–º–ø –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ main service –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö, –∏–º–µ—é—â–∏—Ö –≥–µ–º `fury_dumper`.\
*–î–æ–∫–∏ –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö: [English](README.md).*

–í —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤—ã –Ω–∞–π–¥–µ—Ç–µ —Ñ–∞–π–ª—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ Ruby. 
–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–º–æ—á—å - –∫–æ–¥–∏—Ç—å —Ç—É—Ç—å  `lib / fury_dumper` üòä.\
*–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∑–¥–µ—Å—å: [English](README.md#dev-documentation), [Russian](README.ru.md#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–¥–ª—è-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤).*

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ü–∏—à–µ–º –≤ Gemfile –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

```ruby
gem 'fury_dumper'
```

–í—ã–ø–æ–ª–Ω—è–µ–º:

    bundle install

–í –æ–¥–∏–Ω–æ—á–∫—É –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–∫:

    gem install fury_dumper

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥–∏

–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

    bundle exec rails generate fury_dumper:config

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `fury_dumper.yml` –∫–æ–Ω—Ñ–∏–≥. –û–ø–∏—Å–∞–Ω–∏–µ –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```yaml
# –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 
batch_size: 100

# –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π (fetching_records), –≤—ã–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑ –ë–î, –∫ —Ä–∞–∑–º–µ—Ä—É –±–∞—Ç—á–∞
# –§–æ—Ä–º—É–ª–∞: fetching_records = ratio_records_batches * batch_size
# fetching_records –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è limit'–∞ –¥–ª—è sql –∑–∞–ø—Ä–æ—Å–æ–≤
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10
ratio_records_batches: 10

# –†–µ–∂–∏–º –æ–±—Ö–æ–¥–∞ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π -  –≤ —à–∏—Ä–∏–Ω—É(:wide) –∏–ª–∏ –≥–ª—É–±–∏–Ω—É(:depth)
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤—è–∑–∏ –≤ —à–∏—Ä–∏–Ω—É  
mode: wide

# –°–≤—è–∑–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –¥–∞–º–ø–∞,
# –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–≥—Ä—É–∑–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
# –∏–∑ –Ω–µ–µ –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö:
#   < –∏–º—è –∫–ª–∞—Å—Å–∞ >.< –∏–º—è —Å–≤—è–∑–∏ >
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
exclude_relations: User.friends, Post.author

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–Ω–Ω—ã–µ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (–±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–∫–∏)
# fast —Ä–µ–∂–∏–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–≥—Ä—É–∂–∞—Ç—å –∑–∞–ø–∏—Å–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–µ–≤—á–∏–Ω–æ–º—É –∫–ª—é—á—É(false) –∏–ª–∏ –Ω–µ—Ç(true),
# –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∞–º–ø–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true
fast: true

# –°–ø–∏—Å–æ–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Å–≤—è–∑–µ–π
#
# –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
relative_services: 
  # –ò–º—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
  #
  # –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
  post_service:
    # –ò–º—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
    # —Å –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç —Ç—è–Ω—É—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ    
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π    
    database: 'post_service_development_dump'

    # –•–æ—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    host: 'localhost'

    # –ü–æ—Ä—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    port: '5432'

    # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    user: 'user'

    # –ü–∞—Ä–æ–ª—å –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    password: 'password'

    # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü, –∏–º–µ—é—â–∏—Ö —Å–≤—è–∑–∏ —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–º (post_service)
    #
    # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
    tables:
      # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã —Å —Ç–µ–∫—É—â–µ–º —Å–µ—Ä–≤–∏—Å–µ      
      #
      # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
      users:
        # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ (post_service)
        #
        # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
        users:
          # –ò–º—è –∫–æ–ª–æ–Ω–∫–∏ –∫ —Ç–∞–±–ª–∏—Ü–µ –¥–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (users)
          # 
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
          self_field_name: 'id'

          # –ò–º—è –º–æ–¥–µ–ª–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ (post_service)
          # 
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
          ms_model_name: 'User'

          # –ò–º—è –∫–æ–ª–æ–Ω–∫–∏ –∫ —Ç–∞–±–ª–∏—Ü–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (involved_users)
          # 
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
          ms_field_name: 'root_user_id'
      root_posts:
        posts:
          self_field_name: 'id'
          ms_model_name: 'Post'
          ms_field_name: 'root_post_id'
  logs_service:
    database: 'logs_service_development_dump'
    host: 'localhost'
    port: '5432'
    user: 'user'
    password: 'password'
    tables:
      users:
        logs:
          self_field_name: "log :: json - >> 'id'"
          ms_model_name: 'Log'
          ms_field_name: 'id'
```

### Routing –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ –≤ `config/routes.rb` –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥—Ä—É–≥–∏–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º –¥–∞–º–ø–∞—Ç—å –ë–î –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

```ruby
  mount FuryDumper::Engine => "fury_dumper" unless Rails.env.production?
```

### –í—ã–∑–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–∫—Ü–∏–∏

**‚ö†Ô∏è ‚ö†Ô∏è ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –≤ —Å–ª—É—á–∞–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –∏–º–µ—é—â–∏–º–∏—Å—è –¥–∞–Ω–Ω—ã–º–∏, –±–æ–ª–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î (—Ç–µ–∫—É—â–∏–µ –ø–µ—Ä–µ—Ç—Ä—É—Ç—Å—è)! ‚ö†Ô∏è ‚ö†Ô∏è ‚ö†Ô∏è**

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –¥–∞–º–ø —Å —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î, –≤ –∫–æ–Ω—Å–æ–ª–µ —É–∫–∞–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'User',
                  field_name:   'token',
                  field_values: ['99999999-8888-4444-1212-111111111111'],
                  database:     'staging',
                  debug_mode:   :short)
```

–í–æ–∑–º–æ–∂–Ω–æ, –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Ö–æ—Å—Ç—É, –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å ssh –∫–æ–º–∞–Ω–¥—É. –ü—Ä–∏–º–µ—Ä –¥–ª—è –ë–î —Å—Ç–µ–π–¥–∂–∞ —Ñ–µ–ª–∏–∫—Å–∞:
```
ssh -NL <local_port>:<host>:<db_port> username@<host>
```

–û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:

| –ê—Ä–≥—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| host | —Ö–æ—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î |
| port | –ø–æ—Ä—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î |
| user | –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î |
| password | –ø–∞—Ä–æ–ª—å –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î |
| database | –∏–º—è –ë–î |
| model_name |–∏–º—è –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–∞–º–ø–∞ |
| field_name | –∏–º—è –ø–æ–ª—è, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥–µ—Ç –¥–∞–º–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä - 'id' –∏–ª–∏ 'admin_token', default='id') |
| field_values | –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è field_name |
| debug_mode | —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (full –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, short - –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, none -  –Ω–∏—á–µ–≥–æ) |
| ask | –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–∏—è—Ö –≤ —Ç–µ–∫—É—â–µ–π –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î |

### –ü—Ä–∏–º–µ—Ä—á–∏–∫–∏

–í —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è—Ç—å `fury_dumper.yml` –∫–æ–Ω—Ñ–∏–≥, –≤–æ–∑–º–∏—Ç–µ [–¥–µ—Ñ–æ–ª—Ç–Ω—ã–π](README.ru.md#–∫–æ–Ω—Ñ–∏–≥–∏). 

–î–∞–º–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ admin_token:
```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'User',
                  field_name:   'admin_token',
                  field_values: [admin_token_value],
                  database:     'staging',
                  debug_mode:   :short)
```
–î–∞–º–ø 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å batch_size - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é batch_size = 100, —á—Ç–æ–± –¥–∞–º–ø–µ—Ä –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –Ω–µ 10 —Ä–∞–∑):
```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'User',
                  field_values: (500..1500),
                  database:     'staging',
                  debug_mode:   :short)
```
–î–∞–º–ø AdminUser:
```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'AdminUser',
                  field_values: 3368,
                  database:     'staging',
                  debug_mode:   :short)
```

–î–∞–º–ø —Å–æ —Å—Ç–µ–π–¥–∂–∞:

```bash
ssh -NL <port>:<host>:<hostport> username@<host>
```

```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'User',
                  field_values: 1,
                  database:     'staging',
                  debug_mode:   :short)
```
–î–∞–º–ø —Å —Ä–µ–ø–ª–∏–∫–∏ –ø—Ä–æ–¥–∞:

```bash
ssh -NL <port>:<host>:<hostport> username@<host>
```

```ruby
FuryDumper.dump(password:     'password', 
                  host:         'localhost',
                  port:         '5632',
                  user:         'username',
                  model_name:   'User',
                  field_values: 1,
                  database:     'production',
                  debug_mode:   :short)
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ üìà

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–º–ø–∞ —Å —Ä–µ–ø–ª–∏–∫–∏ main service (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è, —Å–º [—ç—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥](README.ru.md#–∫–æ–Ω—Ñ–∏–≥–∏))

| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ user | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π | –í—Ä–µ–º—è |
| --- | --- | --- |
| 1 | ~ 150* | 2 min 14 sec |
| 10 | ~ 3 500* | 6 min 15 sec |
| 100 | ~ 10 000* | 11 min 8 sec |
| 1 000 | ~ 10 000* | 16 min 6 sec |

\* –û–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∞—â–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ —Ä–∞–∑–Ω—ã–º –ø—É—Ç—è–º –∏ –º–æ–≥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π, –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ –≤ —Ç–∞–±–ª–∏—Ü–µ —á–∏—Å–ª–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ –ë–î. 

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —é–∑–µ—Ä–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
 
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–°–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞
* PK - primary key
* FK - foreign key
* remote DB - —É–¥–∞–ª–µ–Ω–Ω–∞—è –ë–î, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç —Ç—è–Ω—É—Ç—å—Å—è –¥–∞–Ω—ã–µ
* target DB - —Ç–µ–∫—É—â–∞—è –ë–î, –≤ –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ


## –û–±—Ö–æ–¥ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–±—Ö–ª–¥–∞ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π - –≤ –≥–ª—É–±–∏–Ω—É –∏ –≤ —à–∏—Ä–∏–Ω—É.

### –û–±—Ö–æ–¥ –≤ –≥–ª—É–±–∏–Ω—É

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∫—Ä–∞—Ç—Ü–µ:

1. –ù–∞—Ö–æ–¥–∏–º –º–æ–¥–µ–ª—å
2. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª–∏
3. –î–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏:   
    1. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (PK/FK, –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ç–¥)
    2. –î–∞–º–ø–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é —Å–≤—è–∑—å

–¢–æ –µ—Å—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –æ–±—Ö–æ–¥ –≤ –≥–ª—É–±–∏–Ω—É

![Depth_first_example](Depth-first.png)

### –û–±—Ö–æ–¥ –≤ —à–∏—Ä–∏–Ω—É

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –≤–∫—Ä–∞—Ç—Ü–µ:

1. –ü–æ–ª—É—á–∞–µ–º –º–æ–¥–µ–ª—å –¥–ª—è –¥–∞–º–ø–∞ (–≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ–µ –≤ –æ—á–µ—Ä–µ–¥—å –º–æ–¥–µ–ª–µ–π
2. –ü–æ–∫–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –µ—Å—Ç—å –º–æ–¥–µ–ª–∏
    1. –¢–µ–∫—É—â–µ–π –º–æ–¥–µ–ª—å—é —Å—á–∏—Ç–∞–µ–º –ø–µ—Ä–≤—É—é –≤ –æ—á–µ—Ä–µ–¥–∏
    2. –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å –∏–∑ remote DB
    3. –î–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏ –¥–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏:
        1. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (PK/FK, –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ç–¥)
        2. –ü–æ–º–µ—â–∞–µ–º  —Å–≤—è–∑–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏

–¢–æ –µ—Å—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –æ–±—Ö–æ–¥ –≤ —à–∏—Ä–∏–Ω—É

![Breadth_first_example](Breadth-first.png)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–º–ø–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à–∏—Ä–∏–Ω—É. –≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ, –≤ —Å–≤—è–∑–∏ c —Ç–µ–º, —á—Ç–æ –¥–∞–º–ø–µ—Ä —Å—á–∏—Ç–∞–µ—Ç –±–ª–∏–∂–Ω–∏–µ —Å–≤—è–∑–∏ –±–æ–ª–µ–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º–∏.\
–ù–æ –º–æ–∂–Ω–æ —è–≤–Ω–æ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –¥–∞–º–ø–µ—Ä —Ä–∞–±–æ—Ç–∞—å –≤ –≥–ª—É–±–∏–Ω—É, —É–∫–∞–∑–∞–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ `fury_dumper.yml` —Å—Ç—Ä–æ–∫—É `mode: depth`.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤—è–∑–µ–π —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏

–£ –∫–∞–∂–¥–æ–π —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–æ–π –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π, –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ. –í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º—ã—Ö —Å–≤–∑—è–µ–π:
* has_one –∏ has_many (—Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –≤–º–µ—Å—Ç–µ; has_one –Ω–µ —É—á–∏—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ LIMIT 1, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—è—Å—å –≤ has_many)
* belongs_to
* has_and_belongs_to_many

–ù–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è —Å–≤—è–∑–∏ through.

–ò –Ω–µ–º–Ω–æ–∂–∫–æ –æ —Å–∫–æ—É–ø–∞—Ö –≤ —Å–≤—è–∑–∏ - –æ–Ω–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è. –ù–æ –µ—Å–ª–∏ –µ—Å—Ç—å –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∞—è (–ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è —Å–≤—è–∑—å) - –±–µ–∑ s—Åope, —Ç–æ –±—É–¥–µ—Ç –¥–∞–º–ø–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è —Å–≤—è–∑—å. 

–ù–∞–ø—Ä–∏–º–µ—Ä - —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –≥–ª–∞–≤–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:
* has_many :documents, class_name: 'User::Document'\
* has_one :main_document, -> { main }, class_name: 'User::Document'

–°–≤—è–∑—å main_document –Ω–µ –±—É–¥–µ—Ç —É—á—Ç–µ–Ω–∞ –ø—Ä–∏ –¥–∞–º–ø–µ –≤ —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ documents - –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è —Å–≤—è–∑—å, —Ç–∞–∫ –∫–∞–∫ –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∞—è –∏ –±–µ–∑ s—Åope.\
–ï—Å–ª–∏ –±—ã —Å–≤—è–∑–∏ documents –Ω–µ –±—ã–ª–æ, main_document –¥–∞–º–ø–∞–ª–∞—Å—å –±—ã —Å —É—Å–ª–æ–≤–∏–µ–º.

–¢–∞–∫–∂–µ —É –º–æ–¥–µ–ª–µ–π —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–µ —Å–≤—è–∑–∏ ( `belongs_to :resource, polymorphic: true` –∏ `has_many :devices, as: :owner` ).

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤—è–∑–µ–π has_and_belongs_to_many

–°–≤—è–∑–∏ has_and_belongs_to_many –∏–º–µ—é—Ç –ø—Ä–æ–∫—Å–∏—Ä—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É, –∫–æ—Ç–æ—Ä—É—é —Ç–æ–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–∞–º–ø–∞—Ç—å. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –º–æ–º–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–¥–µ–ª–∏ —É –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –¥–∞–Ω–Ω–∞—è —Å–≤—è–∑—å.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã c as-—Å–≤—è–∑—è–º–∏

–°–≤—è–∑–∏ —Ç–∏–ø–∞ as –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–Ω–æ –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö. –í —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ –∫ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—É –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π –∏ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è, –Ω–µ—Å—è –∫–∞–∂–¥–∞—è —Å–≤–æ–π —Å–º—ã—Å–ª –∏ –ø–æ—Ç–µ—Ä—è—Ç—å –∏—Ö –Ω–µ–ª—å–∑—è.\
–ù–∞–ø—Ä–∏–º–µ—Ä, —Å–≤—è–∑—å –¥–ª—è —é–∑–µ—Ä–∞ `has_many :devices, as: :owner` –º–æ–∂–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —É –ª–∏–¥–∞. –ò –≤ –∏–¥–µ–∞–ª—å–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π ü¶Ñ –Ω—É–∂–Ω–æ –≤—ã—Ç–∞—â–∏—Ç—å –æ–±–µ.\
–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–± –¥–∞–º–ø–∞—Ç—å –æ–±–µ –º–æ–¥–µ–ª–∏, –±—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—É—Ç—å —Å–≤—è–∑–µ–π (—Ç–æ–ª—å–∫–æ as) –ø–æ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏—à–ª–∞ –º–æ–¥–µ–ª—å. –ò –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ –ø—É—Ç–µ–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–ø—É—Ç–µ–º –¥–ª—è –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏, —Ç–æ –æ–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏ –Ω–µ –±—É–¥—É—Ç –¥–∞–º–ø–∞—Ç—å—Å—è.

## –†–µ–∂–∏–º –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ–æ–≤

–†–µ–∂–∏–º –±—ã—Å—Ç—Ä—ã—Ö sql-–∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞–±–æ–∞—Ç–µ—Ç –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–∞–º–ø–∞—Ç—å **–ø–æ—Å–ª–µ–¥–Ω–∏–µ** –∑–∞–ø–∏—Å–∏ –≤ –º–æ–¥–µ–ª–∏, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `fast: false` –≤ –∫–æ–Ω—Ñ–∏–≥–µ. \
–í –±—ã—Å—Ç—Ä–æ–º —Ä–µ–∂–∏–º–µ sql –∑–∞–ø—Ä–æ—Å—ã –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:
```sql
SELECT * FROM table WHERE fk_id IN (...) LIMIT 1000;
```
–í –Ω–µ –±—ã—Å—Ç—Ä–æ–º —Ä–µ–∂–∏–º–µ sql –∑–∞–ø—Ä–æ—Å—ã –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:
```sql
SELECT * FROM table WHERE fk_id IN (...) ORDER BY table.id LIMIT 1000
```
–ù–æ –Ω–µ–±—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ pg-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—Ç—Ä–æ–∏—Ç –∑–∞–ø—Ä–æ—Å –ø–æ –∏–Ω–¥–µ–∫—Å—É –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞, –∞ fk_id IN (...) —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ, —á—Ç–æ —Ä–∞–±–æ—Ç–µ—Ç –¥–æ–ª—å—à–µ.

## –ö—Ä–∞—Ç–∫–æ –æ –∫–ª–∞—Å—Å–∞—Ö

* FuryDumper - –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–∞–º–ø–∞, –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –±–∞—Ç—á–∏–Ω–≥ –Ω–∞ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
* FuryDumper::Dumper - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–∞–º–ø–∞, –∑–¥–∞—Å—å –ª–µ–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ö–æ–¥–∞ —Å–≤—è–∑–µ–π
* FuryDumper::Dumpers::Model - –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏
* FuryDumper::Dumpers::ModelQueue - –æ—á–µ—Ä–µ–¥—å –º–æ–¥–µ–ª–µ–π –¥–ª—è –¥–∞–º–ø–∞ –≤ —à–∏—Ä–∏–Ω—É
* FuryDumper::Dumpers::DumpState - –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞–º–ø–∞, —Ç—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Ö –º–æ–¥–µ–ª—è—Ö, —á—Ç–æ —É–∂–µ –¥–∞–º–ø–∞–ª–∏ –∏ –ø–æ–¥–≤–æ–¥–∏—Ç—Å—è –Ω–µ–±–æ–ª—å—à–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∞–º–ø—É
* FuryDumper::Dumpers::RelationItem - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–∏ - –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –¥–∞–º–ø–∞–ª–∏. –î–ª—è –æ–±—ã—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ RelationItem —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º. Additional –æ–ø—Ü–∏—è –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ä–∞–≤–Ω–∏—Ç—å –ø–æ –∫–ª—é—á—É –∏ –∑–Ω–∞—á–µ–Ω–∏—é. Complex - —è–≤–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –∫–ª—é—á, —Ç–æ –µ—Å—Ç—å –≤ –∫–ª—é—á–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ —Ç–∏–ø–∞ `date_from IS NULL`, —è–≤–ª—è—é—â–∞—è—Å—è —É—Å–ª–æ–≤–∏–µ–º –¥–ª—è —Å–≤—è–∑–∏. 
* FuryDumper::Api - –∫–ª–∞—Å—Å –¥–ª—è —Å–≤—è–∑–∏ —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏
* FuryDumper::Config - –∫–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥–∞
* FuryDumper::Encrypter - –∫–ª–∞—Å—Å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
